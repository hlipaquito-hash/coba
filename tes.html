<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antigravity Player Card Generator - STEM X Football</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.18.0/matter.min.js"></script>

    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f9fafb; /* Light background */
            /* Crucial: Must be set to full height for physics */
            min-height: 100vh;
            overflow: hidden; /* Hide scrollbars that physics might cause */
        }
        
        /* The main container for all physics elements */
        #physics-container {
            position: relative;
            width: 100%;
            height: 100vh;
            pointer-events: none; /* Allows clicks to fall through to the input form below */
        }

        /* FIFA Card Styling (Copied from previous turn, slightly simplified) */
        .fut-card {
            width: 300px;
            height: 485px;
            background: linear-gradient(135deg, #fbbf24 0%, #d97706 50%, #92400e 100%);
            border-radius: 18px;
            position: absolute; /* IMPORTANT: Must be absolute for Matter.js to position it */
            color: #4b2c05;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            border: 2px solid #fcd34d;
            z-index: 10;
            pointer-events: auto; /* Allow the card itself to be dragged/clicked */
        }
        
        /* Input Form container - must be on top of the physics layer */
        #input-controls {
            position: fixed; /* Fixes it in place relative to the viewport */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50; /* Ensure it is above the physics elements */
            width: 90%;
            max-width: 450px;
            pointer-events: auto; /* Ensure inputs are clickable */
        }

        .card-rating { font-size: 2.5rem; font-weight: 800; }
        .card-position { font-size: 1.2rem; margin-top: 5px; font-weight: 800; }
        .card-name { font-size: 1.5rem; font-weight: 800; text-transform: uppercase; text-align: center; }
        .card-stats { display: grid; grid-template-columns: 1fr 1fr; padding: 0 30px; }
        .stat-row { display: flex; justify-content: space-between; font-size: 1.1rem; font-weight: 600; }
        .stat-label { font-weight: 400; margin-left: 5px; }

        /* The canvas where the physics simulation runs will cover the entire screen */
        canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 5;
        }

    </style>
</head>
<body>
    
    <div id="physics-container"></div>

    <div id="input-controls" class="bg-white p-8 rounded-2xl shadow-2xl border-4 border-green-600">
        <h1 class="text-3xl font-bold text-green-800 mb-2 text-center">Antigravity Card Generator</h1>
        <p class="text-gray-600 mb-8 text-center">Type your stats and watch the card fall! Click & drag the card to throw it!</p>

        <form id="cardForm" class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Player Name</label>
                    <input type="text" id="inputName" value="STUDENT" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Position</label>
                    <select id="inputPos" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        <option value="ST">ST</option>
                        <option value="RW">RW</option>
                        <option value="CAM">CAM</option>
                    </select>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Performance Stats (0-99)</label>
                <div class="grid grid-cols-3 gap-3">
                    <input type="number" class="stat-input w-full border rounded px-2 py-1" data-target="pac" value="85" max="99" min="0" placeholder="PAC">
                    <input type="number" class="stat-input w-full border rounded px-2 py-1" data-target="sho" value="78" max="99" min="0" placeholder="SHO">
                    <input type="number" class="stat-input w-full border rounded px-2 py-1" data-target="pas" value="82" max="99" min="0" placeholder="PAS">
                    <input type="number" class="stat-input w-full border rounded px-2 py-1" data-target="dri" value="88" max="99" min="0" placeholder="DRI">
                    <input type="number" class="stat-input w-full border rounded px-2 py-1" data-target="def" value="45" max="99" min="0" placeholder="DEF">
                    <input type="number" class="stat-input w-full border rounded px-2 py-1" data-target="phy" value="70" max="99" min="0" placeholder="PHY">
                </div>
            </div>

        </form>
        
        <button onclick="downloadCard()" class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 rounded-xl">
            Download Card (Stops Gravity)
        </button>
    </div>

    <div id="playerCard" class="fut-card">
        <div class="card-content p-4">
            <div class="card-top flex justify-between items-start mb-2">
                <div class="card-info flex flex-col items-center">
                    <span class="card-rating" id="dispRating">80</span>
                    <span class="card-position" id="dispPos">ST</span>
                </div>
                <div class="w-24 h-24 overflow-hidden rounded-full border-2 border-green-700">
                    <img id="dispImage" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Student" class="w-full h-full object-cover" alt="Player">
                </div>
            </div>

            <div class="card-name mb-4" id="dispName">STUDENT</div>

            <div class="card-stats">
                <div class="stat-row"><span id="dispPac">85</span> <span class="stat-label">PAC</span></div>
                <div class="stat-row"><span id="dispDri">88</span> <span class="stat-label">DRI</span></div>
                <div class="stat-row"><span id="dispSho">78</span> <span class="stat-label">SHO</span></div>
                <div class="stat-row"><span id="dispDef">45</span> <span class="stat-label">DEF</span></div>
                <div class="stat-row"><span id="dispPas">82</span> <span class="stat-label">PAS</span></div>
                <div class="stat-row"><span class="stat-label">PHY</span><span id="dispPhy">70</span> </div>
            </div>
        </div>
    </div>


    <script>
        // --- 1. Card Generator Logic (Adapted for Gravity) ---
        const inputs = {
            name: document.getElementById('inputName'),
            pos: document.getElementById('inputPos'),
            stats: document.querySelectorAll('.stat-input')
        };
        const display = {
            name: document.getElementById('dispName'),
            pos: document.getElementById('dispPos'),
            rating: document.getElementById('dispRating'),
            // ... other stats
        };
        const cardElement = document.getElementById('playerCard');
        
        // Update Text Fields
        inputs.name.addEventListener('input', (e) => display.name.textContent = e.target.value || 'STUDENT');
        inputs.pos.addEventListener('change', (e) => display.pos.textContent = e.target.value);

        // Update Stats & Calculate Average
        function updateStats() {
            let total = 0;
            let count = 0;
            inputs.stats.forEach(input => {
                const val = parseInt(input.value) || 0;
                const targetId = 'disp' + input.dataset.target.charAt(0).toUpperCase() + input.dataset.target.slice(1);
                const targetEl = document.getElementById(targetId);
                
                if(targetEl) targetEl.textContent = val;
                
                total += val;
                count++;
            });

            // Math: Calculate Mean Average
            const average = Math.round(total / count);
            display.rating.textContent = average;

            // Simple Card Color Logic
            const card = document.getElementById('playerCard');
            if (average >= 90) {
                card.style.background = 'linear-gradient(135deg, #15803d 0%, #064e3b 100%)'; // Elite Green
                card.style.borderColor = '#4ade80';
            } else if (average >= 80) {
                card.style.background = 'linear-gradient(135deg, #fbbf24 0%, #d97706 100%)'; // Gold
                card.style.borderColor = '#fcd34d';
            } else {
                card.style.background = 'linear-gradient(135deg, #94a3b8 0%, #475569 100%)'; // Silver
                card.style.borderColor = '#cbd5e1';
            }
        }

        inputs.stats.forEach(input => {
            input.addEventListener('input', updateStats);
        });

        // Initialize
        updateStats();


        // --- 2. Google Antigravity (Matter.js) Logic ---
        
        // Modules
        const { Engine, Render, Runner, Bodies, Composite, Mouse, MouseConstraint } = Matter;
        let engine, runner, render;
        let cardBody;

        function initializePhysics() {
            // 1. Create Engine
            engine = Engine.create();
            engine.world.gravity.y = 1; // Standard gravity

            // 2. Create Renderer
            const container = document.getElementById('physics-container');
            render = Render.create({
                element: container,
                engine: engine,
                options: {
                    width: window.innerWidth,
                    height: window.innerHeight,
                    wireframes: false, // Use textures/colors, not just lines
                    background: 'transparent'
                }
            });
            Render.run(render);

            // 3. Create Runner
            runner = Runner.create();
            Runner.run(runner, engine);

            // 4. Create Walls (Boundaries)
            const wallOptions = { isStatic: true, render: { fillStyle: 'transparent' } };
            const walls = [
                // Bottom wall
                Bodies.rectangle(window.innerWidth / 2, window.innerHeight + 50, window.innerWidth, 100, wallOptions),
                // Left wall
                Bodies.rectangle(-50, window.innerHeight / 2, 100, window.innerHeight, wallOptions),
                // Right wall
                Bodies.rectangle(window.innerWidth + 50, window.innerHeight / 2, 100, window.innerHeight, wallOptions),
            ];
            Composite.add(engine.world, walls);
            
            // 5. Create the Physics Body for the Card
            const cardWidth = cardElement.offsetWidth;
            const cardHeight = cardElement.offsetHeight;
            
            // Start the card high up
            cardBody = Bodies.rectangle(window.innerWidth / 2, 0, cardWidth, cardHeight, {
                restitution: 0.5, // How bouncy it is
                density: 0.001,
                friction: 0.5,
                chamfer: { radius: 18 }, // Match CSS border radius
                render: { 
                    // This is the key: set the visible element as the texture
                    sprite: { 
                        texture: '#' + cardElement.id, 
                        xScale: 1, 
                        yScale: 1 
                    } 
                }
            });
            
            Composite.add(engine.world, cardBody);

            // 6. Add Mouse Interaction (Drag and Throw)
            const mouse = Mouse.create(render.canvas);
            const mouseConstraint = MouseConstraint.create(engine, {
                mouse: mouse,
                constraint: {
                    stiffness: 0.2,
                    render: { visible: false }
                }
            });
            Composite.add(engine.world, mouseConstraint);
            render.mouse = mouse; // Keep mouse sync with renderer

            // 7. Sync the HTML card element with the Physics body
            (function renderCard() {
                const pos = cardBody.position;
                const angle = cardBody.angle;
                
                cardElement.style.transform = `translate(-50%, -50%) translate(${pos.x}px, ${pos.y}px) rotate(${angle}rad)`;
                
                // Continue loop
                window.requestAnimationFrame(renderCard);
            })();

            // Handle Resize
            window.addEventListener('resize', () => {
                // Resize the renderer
                render.bounds.max.x = window.innerWidth;
                render.bounds.max.y = window.innerHeight;
                render.options.width = window.innerWidth;
                render.options.height = window.innerHeight;
                Render.setPixelRatio(render, window.devicePixelRatio);
                
                // Reposition the walls (simplest way)
                Composite.remove(engine.world, walls);
                walls.splice(0, walls.length, 
                    Bodies.rectangle(window.innerWidth / 2, window.innerHeight + 50, window.innerWidth, 100, wallOptions),
                    Bodies.rectangle(-50, window.innerHeight / 2, 100, window.innerHeight, wallOptions),
                    Bodies.rectangle(window.innerWidth + 50, window.innerHeight / 2, 100, window.innerHeight, wallOptions)
                );
                Composite.add(engine.world, walls);
            });
        }

        document.addEventListener('DOMContentLoaded', initializePhysics);

        // --- 3. Download Logic (Modified) ---
        function downloadCard() {
            // Temporarily disable physics simulation for a clean screenshot
            Runner.stop(runner); 
            
            // Set card to a fixed position for a clean download image
            cardElement.style.position = 'static';
            cardElement.style.transform = 'none';

            html2canvas(cardElement, {
                scale: 2, 
                backgroundColor: null,
                logging: false,
                useCORS: true // Important for external images like Dicebear
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = display.name.textContent + '_Card.png';
                link.href = canvas.toDataURL();
                link.click();
                
                // Restore card element and restart physics
                cardElement.style.position = 'absolute';
                Runner.run(runner, engine); 
                
                // Re-apply the position synchronization immediately
                const pos = cardBody.position;
                const angle = cardBody.angle;
                cardElement.style.transform = `translate(-50%, -50%) translate(${pos.x}px, ${pos.y}px) rotate(${angle}rad)`;
            });
        }
    </script>
</body>
</html>
